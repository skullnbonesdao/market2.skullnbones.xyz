import{Q as W,a as U,b as oe}from"./QTabs.811dc996.js";import{Q as Ce}from"./QPage.6ea5f0d2.js";import{bZ as P,cr as qe,bE as k,bY as z,b_ as O,b$ as M,c0 as K,df as ie,dg as ee,cj as j,a9 as T,aI as p,Z as A,bc as o,a7 as e,cl as te,a0 as f,H as w,A as h,cb as x,n as b,$,cc as pe,be,M as ae,cg as R,ce as _,ca as I,cf as H,a6 as B,dh as F,ck as $e,cd as re,aC as G,cp as g,b7 as D,ch as q,ci as V,_ as Q,D as Y,aQ as Qe,aO as Ie,d1 as Ve}from"./index.12c8ad16.js";import{c as ye,b as ve,a as v,C as Z,Q as we}from"./QTr.8954d3e2.js";import{i as J,j as ge,h as Be,Q as Ke}from"./use-checkbox.2db3a894.js";import{Q as E}from"./QCard.964c4506.js";import{f as We,A as ke,Q as Pe}from"./format_address.a32070b0.js";import{e as Ae,u as ne,a as le,T as se,Q as he,b as xe,C as Se}from"./ClosePopup.9b7875ae.js";import{Q as Te}from"./QCardSection.4aaf1593.js";import{h as X}from"./handle_confirmation.3ffd8579.js";import{_ as Ee}from"./plugin-vue_export-helper.21dcd24c.js";import"./QResizeObserver.134c7d28.js";import"./QSeparator.b3f731aa.js";import"./use-dark.94af0dbe.js";const Ue=c=>{const a=P(c),{encode:i,decode:d}=Ae(a),s=a;return s.decode=(t,r)=>!!d(t,r),s.encode=(t,r,n)=>{const u=Number(t);return i(u,r,n)},s},ue=c=>{const a=qe(32,c),{encode:i,decode:d}=Ae(a),s=a;return s.decode=(t,r)=>{const n=d(t,r);return new k(n)},s.encode=(t,r,n)=>{const u=t.toBuffer();return i(u,r,n)},s};class De extends Error{constructor(a){super(a)}}class Le extends De{constructor(){super(...arguments),this.name="TokenOwnerOffCurveError"}}const ce=z([P("instruction"),ne("amount")]);function ze(c,a,i,d,s=[],t=K){const r=le([{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0}],i,s),n=O.Buffer.alloc(ce.span);return ce.encode({instruction:se.Burn,amount:BigInt(d)},n),new M({keys:r,programId:t,data:n})}const de=z([P("instruction")]);function me(c,a,i,d=[],s=K){const t=le([{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0}],i,d),r=O.Buffer.alloc(de.span);return de.encode({instruction:se.CloseAccount},r),new M({keys:t,programId:s,data:r})}const Oe=z([ie("mintAuthorityOption"),ue("mintAuthority"),ne("supply"),P("decimals"),Ue("isInitialized"),ie("freezeAuthorityOption"),ue("freezeAuthority")]);Oe.span;async function L(c,a,i=!1,d=K,s=ee){if(!i&&!k.isOnCurve(a.toBuffer()))throw new Le;const[t]=await k.findProgramAddress([a.toBuffer(),d.toBuffer(),c.toBuffer()],s);return t}function Me(c,a,i,d,s=K,t=ee){return Fe(c,a,i,d,O.Buffer.alloc(0),s,t)}function Fe(c,a,i,d,s,t=K,r=ee){const n=[{pubkey:c,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:j.programId,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1}];return new M({keys:n,programId:r,data:s})}const fe=z([P("instruction"),ne("amount")]);function Ne(c,a,i,d,s=[],t=K){const r=le([{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0}],i,s),n=O.Buffer.alloc(fe.span);return fe.encode({instruction:se.Transfer,amount:BigInt(d)},n),new M({keys:r,programId:t,data:n})}const N=T({__name:"SolscanLink",props:["address"],setup(c){return(a,i)=>(p(),A(x,{class:"full-width",square:"",color:"primary",size:"sm",icon:"link",target:"_blank",href:"https://solscan.io/account/"+c.address},{default:o(()=>[e(te),f("div",null,w(h(We)(c.address)),1)]),_:1},8,["href"]))}}),je=f("span",{class:"text-weight-bold"},"Send Token",-1),Re={class:"text-overline"},He={class:"row"},Ge=T({__name:"SendTokenButton",props:["mint","decimals"],setup(c){const a=b(!1),i=c,d=b(""),s=b(0);async function t(){const r=new R,n=await L(new k(i.mint),new k(d.value));console.log(n);const u=await L(new k(i.mint),_().publicKey.value);await I().connection.getAccountInfo(n)===null&&r.add(Me(_().publicKey.value,n,new k(d.value),new k(i.mint))),r.add(Ne(u,n,_().publicKey.value,s.value*Math.pow(10,i.decimals)));try{const l=await _().sendTransaction(r,I().connection);await X(l)}catch(l){H.create({color:"red",message:`${l}`,timeout:5e3})}}return(r,n)=>(p(),$(ae,null,[e(x,{square:"",color:"secondary",size:"sm",icon:"send",onClick:n[0]||(n[0]=u=>a.value=!0)}),e(ge,{modelValue:a.value,"onUpdate:modelValue":n[4]||(n[4]=u=>a.value=u)},{default:o(()=>[e(E,null,{default:o(()=>[e(he,{class:"q-mt-md"},{default:o(()=>[e(pe,null,{default:o(()=>[e(te,{name:"send"})]),_:1}),e(xe,null,{default:o(()=>[je,f("div",Re,w(c.mint),1)]),_:1}),be(e(x,{flat:"",round:"",dense:"",icon:"close"},null,512),[[Se]])]),_:1}),e(Te,{class:"q-gutter-y-sm"},{default:o(()=>[f("div",null,[e(J,{filled:"",square:"",label:"Receiver",modelValue:d.value,"onUpdate:modelValue":n[1]||(n[1]=u=>d.value=u)},null,8,["modelValue"])]),f("div",He,[e(J,{filled:"",square:"",class:"col",label:"Amount",modelValue:s.value,"onUpdate:modelValue":n[2]||(n[2]=u=>s.value=u)},null,8,["modelValue"]),e(x,{square:"",color:"primary",icon:"send",onClick:n[3]||(n[3]=u=>t())})])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),Ye=f("span",{class:"text-weight-bold"},"Close/Burn Account",-1),Ze={class:"text-overline"},Je=f("div",{class:"row q-gutter-x-sm"},[f("div",{class:""},"Closing Token-Accounts will recover the fee!")],-1),Xe={class:"row q-gutter-x-sm"},et=f("div",{class:""},"Amount left:",-1),tt={class:""},at={class:"q-ma-md text-right text-weight-light"},nt=T({__name:"EditTokenButton",props:["mint","decimals","amount"],setup(c){const a=b(!1),i=c;b(""),b(0);async function d(){const t=new R,r=await L(new k(i.mint),_().publicKey.value);t.add(ze(r,new k(i.mint),_().publicKey.value,i.amount*Math.pow(10,i.decimals))),t.add(me(r,_().publicKey.value,_().publicKey.value)),t.add(j.transfer({fromPubkey:_().publicKey.value,toPubkey:new k(re),lamports:F}));try{const n=await _().sendTransaction(t,I().connection);await X(n)}catch(n){H.create({color:"red",message:`${n}`,timeout:5e3})}}async function s(){const t=new R,r=await L(new k(i.mint),_().publicKey.value);t.add(me(r,_().publicKey.value,_().publicKey.value)),t.add(j.transfer({fromPubkey:_().publicKey.value,toPubkey:new k(re),lamports:F}));try{const n=await _().sendTransaction(t,I().connection);await X(n)}catch(n){H.create({color:"red",message:`${n}`,timeout:5e3})}}return(t,r)=>(p(),$(ae,null,[e(x,{square:"",color:"primary",size:"sm",icon:"edit",onClick:r[0]||(r[0]=n=>a.value=!0)}),e(ge,{modelValue:a.value,"onUpdate:modelValue":r[3]||(r[3]=n=>a.value=n)},{default:o(()=>[e(E,null,{default:o(()=>[e(he,{class:"q-mt-md"},{default:o(()=>[e(pe,null,{default:o(()=>[e(te,{name:"edit"})]),_:1}),e(xe,null,{default:o(()=>[Ye,f("div",Ze,w(c.mint),1)]),_:1}),be(e(x,{flat:"",round:"",dense:"",icon:"close"},null,512),[[Se]])]),_:1}),e(Te,{class:"q-gutter-y-md col justify-around"},{default:o(()=>[Je,f("div",Xe,[et,f("div",tt,w(c.amount),1)]),e(x,{square:"",disabled:c.amount==0,class:"full-width",color:"red",onClick:r[1]||(r[1]=n=>d())},{default:o(()=>[B(" Burn and close Account ")]),_:1},8,["disabled"]),e(x,{square:"",disabled:c.amount>0,class:"full-width",color:"orange",onClick:r[2]||(r[2]=n=>s())},{default:o(()=>[B(" Close Account")]),_:1},8,["disabled"])]),_:1}),f("div",at," service-fee: "+w(h(F)/h($e))+"sol ",1)]),_:1})]),_:1},8,["modelValue"])],64))}}),lt={key:0,class:"row"},st=f("div",{class:"col-2 q-table__title"},"Accounts",-1),ot={class:"text-subtitle1"},it={class:"row items-center justify-end q-gutter-x-sm"},rt={class:"row items-center justify-end q-gutter-x-sm"},ut=T({__name:"WalletAccountsTable",props:["tab"],setup(c){const a=c;b();const i=b(["name","type","action","amount","market_usdc","market_atlas"]),d=[{name:"image",label:"",align:"left",required:!0},{name:"name",label:"Name",align:"left",sortable:!0,required:!0,field:u=>u.staratlas.name},{name:"type",label:"Type",align:"left",sortable:!0,field:u=>u.staratlas.attributes.itemType},{name:"account",label:"Account",align:"left",sortable:!0,field:u=>u.pubkey},{name:"mint",label:"Mint",align:"left",sortable:!0,field:u=>u.info.mint},{name:"owner",align:"left",label:"Owner",sortable:!0,field:u=>u.info.owner},{name:"decimals",label:"Decimals",sortable:!0,field:u=>{var m;return(m=u.info.tokenAmount)==null?void 0:m.decimals}},{name:"amount",label:"Amount",align:"right",sortable:!0,field:u=>{var m;return(m=u.info.tokenAmount)==null?void 0:m.uiAmount}},{name:"market_usdc",label:"Market [USDC]",align:"right",field:u=>{var m;return(m=u.info.tokenAmount)==null?void 0:m.uiAmount}},{name:"market_atlas",label:"Market [ATLAS]",align:"right",field:u=>{var m;return(m=u.info.tokenAmount)==null?void 0:m.uiAmount}},{label:"",align:"right",name:"action"}];G(async()=>{await g().update_accounts()}),D(()=>_().publicKey.value,async()=>{await g().update_accounts()});const s=b({rowsPerPage:0}),t=b([]),r=b([]);G(async()=>{var u,m;t.value=await I().api_client.trades.getPrices(((u=q.find(l=>l.type==V.USDC))==null?void 0:u.mint)??"none"),r.value=await I().api_client.trades.getPrices(((m=q.find(l=>l.type==V.ATLAS))==null?void 0:m.mint)??"none"),await g().update_accounts()});function n(){return a.tab=="all"?g().get_account_map_staratlas:g().get_account_map_staratlas.filter(u=>{var m;return((m=u.staratlas.attributes.itemType)==null?void 0:m.toLowerCase())==a.tab})}return(u,m)=>(p(),A(E,{flat:""},{default:o(()=>[h(g)().is_loading?(p(),$("div",lt,[e(W),e(ye,{class:"row",color:"primary",size:"3rem"}),e(W)])):Q("",!0),e(we,{color:"primary",dark:"",flat:"",square:"","virtual-scroll":"",pagination:s.value,"onUpdate:pagination":m[1]||(m[1]=l=>s.value=l),"rows-per-page-options":[0],"visible-columns":i.value,title:"Accounts",rows:n(),columns:d,"row-key":"name"},{top:o(l=>[st,e(W),e(Be,{modelValue:i.value,"onUpdate:modelValue":m[0]||(m[0]=y=>i.value=y),multiple:"",borderless:"",dense:"","options-dense":"","display-value":u.$q.lang.table.columns,"emit-value":"","map-options":"",options:d,"option-value":"name",style:{"min-width":"150px"}},null,8,["modelValue","display-value"]),e(x,{flat:"",round:"",dense:"",icon:l.inFullscreen?"fullscreen_exit":"fullscreen",onClick:l.toggleFullscreen,class:"q-ml-md"},null,8,["icon","onClick"])]),body:o(l=>[e(ve,{props:l},{default:o(()=>[e(v,{key:"image",props:l},{default:o(()=>[e(ke,{size:"xl",url:"sa_files/webp/"+l.row.info.mint+".webp"},null,8,["url"])]),_:2},1032,["props"]),e(v,{key:"name",props:l},{default:o(()=>[f("div",ot,w(l.row.staratlas.name??"-"),1)]),_:2},1032,["props"]),e(v,{key:"type",props:l},{default:o(()=>[B(w(l.row.staratlas.attributes.itemType??"-"),1)]),_:2},1032,["props"]),e(v,{key:"account",props:l},{default:o(()=>[e(N,{address:l.row.pubkey},null,8,["address"])]),_:2},1032,["props"]),e(v,{key:"owner",props:l},{default:o(()=>[e(N,{address:l.row.info.owner},null,8,["address"])]),_:2},1032,["props"]),e(v,{key:"mint",props:l,class:""},{default:o(()=>[e(N,{address:l.row.info.mint},null,8,["address"])]),_:2},1032,["props"]),e(v,{key:"decimals",props:l},{default:o(()=>{var y;return[B(w((y=l.row.info.tokenAmount)==null?void 0:y.decimals),1)]}),_:2},1032,["props"]),e(v,{key:"amount",class:"text-subtitle1 text-bold",props:l},{default:o(()=>{var y,S;return[f("div",{class:Y(((y=l.row.info.tokenAmount)==null?void 0:y.uiAmount)==0?"text-yellow":"")},w((S=l.row.info.tokenAmount)==null?void 0:S.uiAmount.toFixed(0)),3)]}),_:2},1032,["props"]),e(v,{key:"market_usdc",class:"text-subtitle1 text-bold",props:l},{default:o(()=>{var y,S;return[f("div",it,[f("div",null,w(((((y=t.value.find(C=>C.asset==l.row.info.mint))==null?void 0:y.price)??0)*((S=l.row.info.tokenAmount)==null?void 0:S.uiAmount.toFixed(0))).toFixed(2)),1),e(Z,{currency:h(q).find(C=>C.type==h(V).USDC)},null,8,["currency"])])]}),_:2},1032,["props"]),e(v,{key:"market_atlas",class:"text-subtitle1 text-bold",props:l},{default:o(()=>{var y,S;return[f("div",rt,[f("div",null,w(((((y=r.value.find(C=>C.asset==l.row.info.mint))==null?void 0:y.price)??0)*((S=l.row.info.tokenAmount)==null?void 0:S.uiAmount.toFixed(0))).toFixed(2)),1),e(Z,{currency:h(q).find(C=>C.type==h(V).ATLAS)},null,8,["currency"])])]}),_:2},1032,["props"]),e(v,{key:"action",props:l,class:"q-gutter-x-sm"},{default:o(()=>[e(nt,{amount:l.row.info.tokenAmount.uiAmount,mint:l.row.info.mint,decimals:l.row.info.tokenAmount.decimals},null,8,["amount","mint","decimals"]),e(Ge,{mint:l.row.info.mint,decimals:l.row.info.tokenAmount.decimals},null,8,["mint","decimals"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["pagination","visible-columns","rows"])]),_:1}))}}),ct=T({__name:"WalletAccountInput",setup(c){const a=b("");D(()=>_().publicKey.value,()=>{g().input_wallet=_().publicKey.value.toString()});async function i(){a.value.length?await g().update_accounts(new k(a.value)):await g().update_accounts()}return(d,s)=>(p(),A(E,{square:"",flat:"",class:"row"},{default:o(()=>[e(J,{label:"Wallet-Address",modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=t=>a.value=t),clearable:"","clear-icon":"close",square:"",filled:"",class:"col"},null,8,["modelValue"]),e(x,{onClick:s[1]||(s[1]=t=>{i().then(()=>{h(g)().input_wallet=a.value})}),color:"secondary",square:"",size:"md",icon:"fa-solid fa-paper-plane"},{default:o(()=>[e(Pe,null,{default:o(()=>[B("Query wallet")]),_:1})]),_:1})]),_:1}))}});const dt={class:"row items-center q-gutter-x-xs justify-end"},mt={class:"row items-center q-gutter-x-xs justify-end"},ft=T({__name:"WalletAccountHistoryTable",props:["data"],setup(c){const a=b({rowsPerPage:0}),i=b([{name:"side",label:"Side",align:"left",field:"side",sortable:!0},{name:"info",align:"left",field:"info",sortable:!0,style:"width: 50px"},{name:"size",align:"right",label:"Size",field:"volume",sortable:!0},{name:"price",align:"right",label:"Price",field:d=>d.price.toFixed(2),sortable:!0}]);return(d,s)=>(p(),A(we,{rows:c.data,dense:"",square:"",flat:"","virtual-scroll":"",columns:i.value,pagination:a.value,"rows-per-page-options":[0],"virtual-scroll-sticky-size-start":48,"row-key":"name","hide-bottom":""},{body:o(t=>[e(ve,{props:t,class:Y(t.row.side=="BUY"?"buy":"sell")},{default:o(()=>[e(v,{key:"side",props:t},{default:o(()=>[e(Ke,{class:Y(t.row.side=="BUY"?"buy":"sell")},{default:o(()=>[B(w(t.row.side),1)]),_:2},1032,["class"])]),_:2},1032,["props"]),e(v,{key:"info",props:t},{default:o(()=>[e(x,{flat:"",size:"sm",icon:"link",href:"https://solscan.io/tx/"+t.row.signature,target:"_blank"},null,8,["href"])]),_:2},1032,["props"]),e(v,{key:"size",props:t},{default:o(()=>[f("div",dt,[f("div",null,w(t.row.size??0),1),e(ke,{style:{width:"10px",height:"10px"},url:"sa_files/webp/"+t.row.asset+".webp"},null,8,["url"])])]),_:2},1032,["props"]),e(v,{key:"price",props:t,class:""},{default:o(()=>[f("div",mt,[f("div",null,w(t.row.price??0),1),e(Z,{style:{width:"14px",height:"14px"},currency:h(q).find(r=>r.mint===t.row.currency)},null,8,["currency"])])]),_:2},1032,["props"])]),_:2},1032,["props","class"])]),_:1},8,["rows","columns","pagination"]))}});const _t={key:0,class:"row"},pt={key:1},bt={key:2,class:"text-center text-body2 q-pa-sm"},_e=100,yt=T({__name:"WalletAccountHistory",setup(c){const a=b(),i=b([]),d=b(!1);D(()=>_().publicKey.value,async()=>{await s(_().publicKey.value.toString())}),D(()=>g().input_wallet,async()=>{await s(g().input_wallet)}),G(async()=>{g().input_wallet?await s(g().input_wallet):await s(_().publicKey.value.toString())});async function s(r){var n,u;d.value=!0,a.value=await I().api_client.trades.search("maker_and_taker",r,_e),i.value.push({name:"USDC",data:(n=a.value)==null?void 0:n.filter(m=>{var l;return m.currency==((l=q.find(y=>y.type==V.USDC))==null?void 0:l.mint)}).map(m=>[m.timestamp,m.price,m.volume])}),i.value.push({name:"ATLAS",data:(u=a.value)==null?void 0:u.filter(m=>{var l;return m.currency==((l=q.find(y=>y.type==V.ATLAS))==null?void 0:l.mint)}).map(m=>[m.timestamp,m.price,m.volume])}),d.value=!1}const t={colors:["#3976ea","#b2b2b2"],chart:{height:350,type:"bubble",toolbar:{show:!1},foreColor:"#ffffff"},dataLabels:{enabled:!1},fill:{opacity:.8},xaxis:{type:"datetime"},yaxis:[{title:{text:"USDC"}},{opposite:!0,title:{text:"ATLAS"}}]};return(r,n)=>{const u=Qe("apexchart");return p(),A(E,{flat:""},{default:o(()=>[d.value?(p(),$("div",_t,[e(W),e(ye,{class:"row q-pa-sm",color:"primary",size:"3rem"}),e(W)])):Q("",!0),a.value?(p(),$("div",pt,[d.value?Q("",!0):(p(),A(u,{key:0,class:"chart",type:"bubble",height:"350",options:t,series:i.value},null,8,["series"])),d.value?Q("",!0):(p(),A(ft,{key:1,data:a.value},null,8,["data"])),f("div",{class:"text-center text-orange-4 text-weight-thin text-right q-mr-md"}," Limited to: "+w(_e))])):(p(),$("div",bt,"No data"))]),_:1})}}});var vt=Ee(yt,[["__scopeId","data-v-5e49c44a"]]);const wt={style:{width:"80vw"}},Kt=T({__name:"WalletPage",setup(c){const a=b("account"),i=b("all");return(d,s)=>(p(),A(Ce,{class:"row q-pa-sm justify-center"},{default:o(()=>[f("div",wt,[e(ct,{class:"q-mb-sm"}),e(oe,{align:"justify",modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=t=>a.value=t)},{default:o(()=>[e(U,{name:"account",label:"Accounts"}),e(U,{name:"activity",label:"Market Activity"})]),_:1},8,["modelValue"]),a.value=="account"?(p(),A(oe,{key:0,align:"justify",modelValue:i.value,"onUpdate:modelValue":s[1]||(s[1]=t=>i.value=t)},{default:o(()=>[e(U,{name:"all",label:"All",class:"bg-secondary"}),(p(!0),$(ae,null,Ie(h(Ve)().get_itemTypes,t=>(p(),A(U,{name:t,label:t,key:t},null,8,["name","label"]))),128))]),_:1},8,["modelValue"])):Q("",!0),a.value=="account"?(p(),A(ut,{key:1,tab:i.value,dark:""},null,8,["tab"])):Q("",!0),a.value=="activity"?(p(),A(vt,{key:2})):Q("",!0)])]),_:1}))}});export{Kt as default};
